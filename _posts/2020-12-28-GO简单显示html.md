---
title: 获取请求参数及响应请求
categories: [writing]
comments: true
---

上一篇显示了html页面，本篇将展示如何获取请求参数，如何将结构体转换为json，以及如何设置重定向<br>



总体代码<br>
```golang
package main

import (
	"encoding/json"
	"fmt"
	"net/http"
	"web02_req/model"
	//web02_req是我的main.go所在的目录名，model是包，新建个目录model在里面放user.go
	/*
	user.go里面是
	package model

	type User struct {
	ID       int
	Username string
	Password string
	Email    string
	}
	*/
)

//这是获取请求
func handler(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintln(w, "请求内容是：", r.FormValue("user"))
	fmt.Fprintln(w, "post请求内容是：", r.PostFormValue("username"))

}

//这是将结构体转换为json并响应请求
func testRes(w http.ResponseWriter, r *http.Request) {
	//设置响应内容类型
	w.Header().Set("Content-Type", "application/json")
	user := model.User{
		ID:       1,
		Username: "admin",
		Password: "123456",
		Email:    "admin@admin.com",
	}
	//这就是转化为json
	json2, _ := json.Marshal(user)
	//err := json.Unmarshal([]byte(json2), &user)就是把json2转换为结构体并存入user,第一个参数必须是byte类型
	w.Write(json2)
}

func testRed(w http.ResponseWriter, r *http.Request) {
	w.Header().Set("Location", "https://www.baidu.com/")
	//设置重定向
	w.WriteHeader(302)
	//必须先设置重定向地址再设置状态码
}

func main() {
	http.HandleFunc("/hello", handler)
	http.HandleFunc("/res", testRes)
	http.HandleFunc("/red", testRed)

	http.ListenAndServe(":8080", nil)
}

```
GO代码另存为main.go
<br>

<br>
html代码另存为index.html，将该html文件放在main.go同一目录下。<br>
执行go build main.go便会生成main.exe，命令行切换到该目录下执行main.exe。<br><br>
需要注意的是在什么地方执行main.exe它就会到当前的执行目录去找相关文件，比如说在桌面用绝对路径执行该exe它就找不到代码里写的index.html，因为桌面没有index.html。
<br>

执行结果
<a href="https://imgchr.com/i/rHkMfs"><img src="https://s3.ax1x.com/2020/12/29/rHkMfs.png" alt="rHkMfs.png" border="0" /></a>

## 代码解释

```golang
func testTemplate(w http.ResponseWriter, r *http.Request) {
	t := template.Must(template.ParseFiles("index.html"))
	t.Execute(w, "hello world!")
} 
```
这个处理器中，template.ParseFiles是用来处理模板文件的，它会返回一个模板和一个error，而把它包裹的template.Must则可以处理错误，经过template.Must处理后最终就只出来了个模板。<br>
t.Execute是执行并传入数据，我的理解是第一个参数是传递的方向，第二个参数就是要传递的数据。<br>
传递过去的数据会代替html里的{{.}}，就像上面图片里的那样，hello world!代替了{{.}}并在页面上显示出来


